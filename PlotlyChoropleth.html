<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>2016 Average Personal Savings Rate</title>
  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>

</head>
<body>
<!-- Plotly chart will be drawn inside this DIV -->
<div id="myDiv"></div>
<script>
 var myPlot = document.getElementById("myDiv");
Plotly.d3.csv('https://raw.githubusercontent.com/Sangjin135/Sangjin135.github.io/Lily/data.csv', function(err, rows){
function unpack(rows, key) {
return rows.map(function(row) { return row[key]; });
}

var data = [{
    type: 'choropleth',
    locationmode: 'USA-states',
    locations: unpack(rows, 'Code'),
    z: unpack(rows, 'difference'),
    text: unpack(rows, 'GeoName'),
    zmin: -50000,
    zmax: 1750000,
    colorscale: 'RdBu',
    hoverinfo: "location+z+text",
  colorbar: {
    title: 'USD',
    thickness: 0.2
  },
  marker: {
    line:{
      color: 'rgb(0,0,0)',
      width: 2
    }
  }
}];

console.log(data.locations);

var layout = {
title: '2016 Difference Between Income and Expenditures',
geo:{
  scope: 'usa',
  showlakes: true,
  lakecolor: 'rgb(255,255,255)'
}
};
Plotly.plot(myDiv, data, layout, {showLink: false});
myPlot.on("plotly_click", d => {
  var pt = (d.points || [])[0]
  var years = ['1997', '1998', '1999', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016']
  Plotly.d3.csv('https://raw.githubusercontent.com/Sangjin135/Sangjin135.github.io/Lily/linechartdata.csv', (err, rows) => {
    var data2 = pt.location.map(y=> {
      var d = rows.filter(r => r.Code === y)
      return {
        type: 'line',
        name: y,
        x: d.map(r => r.Year),
        y: d.map(r => r.SavingsRate)
      }
    })
    Plotly.newPlot('graph', data)
  })
  alert(pt.location)
  });
</script>
</body>
</html>